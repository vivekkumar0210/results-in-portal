{% extends "admin/base_site.html" %}

{% block content %}
<div class="magic-wrapper">
    <div class="magic-header">
        <h1>üöÄ Magic Fast Entry Tool (v3.0)</h1>
        <p>Dynamic Preview & Robust Error Handling</p>
    </div>

    <div class="magic-layout">
        <div class="editor-side">
            <textarea id="json-input" placeholder='Paste JSON here...' spellcheck="false"></textarea>
            <div class="action-buttons">
                <button id="preview-btn" class="btn-preview">üëÅÔ∏è CHECK PREVIEW</button>
                <button id="upload-btn" class="btn-upload">üöÄ UPLOAD TO WEBSITE</button>
            </div>
            <div id="status-message" style="margin-top: 10px; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold;"></div>
        </div>

        <div class="preview-side">
            <div class="preview-badge">LIVE WEBSITE PREVIEW</div>
            <div id="live-display" class="display-box">
                <p class="empty-msg">Waiting for JSON data...</p>
            </div>
        </div>
    </div>
</div>

<style>
    :root { --bg-dark: #0f172a; --card-bg: #1e293b; --accent: #ec4899; --cyan: #22d3ee; }
    .magic-wrapper { font-family: 'Plus Jakarta Sans', sans-serif; color: white; padding: 10px; }
    .magic-header h1 { color: var(--cyan); text-align: center; margin-bottom: 5px; }
    .magic-header p { text-align: center; color: #94a3b8; margin-bottom: 20px; }
    .magic-layout { display: flex; gap: 20px; height: 80vh; }
    .editor-side { flex: 1; display: flex; flex-direction: column; gap: 10px; }
    #json-input { flex: 1; background: #000; color: #4ade80; border: 2px solid #334155; border-radius: 12px; padding: 15px; font-family: 'Courier New', monospace; outline: none; font-size: 14px; line-height: 1.5; }
    .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btn-preview { background: #334155; color: white; border: 2px solid var(--cyan); padding: 15px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
    .btn-preview:hover { background: var(--cyan); color: #000; }
    .btn-upload { background: linear-gradient(90deg, #6366f1, #ec4899); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
    .btn-upload:hover { opacity: 0.9; transform: scale(0.98); }
    .preview-side { flex: 1; background: var(--bg-dark); border-radius: 12px; border: 1px solid #334155; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .preview-badge { background: var(--card-bg); padding: 10px; text-align: center; font-size: 12px; color: var(--cyan); font-weight: 800; border-bottom: 1px solid #334155; }
    .display-box { flex: 1; padding: 25px; overflow-y: auto; color: #cbd5e1; background: #0f172a; }
    .p-title { font-size: 22px; color: #fff; border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 15px; font-weight: 800; text-align: center; }
    .p-label { color: var(--accent); font-size: 12px; font-weight: 800; margin-top: 25px; text-transform: uppercase; letter-spacing: 1px; }
    .p-table { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-top: 8px; border: 1px solid rgba(255,255,255,0.05); line-height: 1.6; }
    .empty-msg { text-align: center; color: #475569; margin-top: 50%; }
</style>

<script>
    const jsonInput = document.getElementById('json-input');
    const display = document.getElementById('live-display');
    const previewBtn = document.getElementById('preview-btn');
    const uploadBtn = document.getElementById('upload-btn');
    const status = document.getElementById('status-message');

    previewBtn.onclick = function() {
        try {
            const rawValue = jsonInput.value.trim();
            if(!rawValue) {
                status.innerHTML = "‚ö†Ô∏è Pehle JSON paste karein!";
                status.style.color = "#fbbf24";
                return;
            }

            const data = JSON.parse(rawValue);
            
            // Sabhi Titles ko check karein
            const displayTitle = data.job_title || data.result_title || data.admit_title || 'Untitled Entry';
            
            display.innerHTML = `
                <div class="p-title">${displayTitle}</div>
                
                <div class="p-label">üìå Post Name</div>
                <div class="p-table">${data.vacancy_name || 'N/A'}</div>

                <div class="p-label">üìÖ Important Dates & Fee</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="p-table"><strong>Dates:</strong><br>${data.start_date || 'N/A'}</div>
                    <div class="p-table"><strong>Fees:</strong><br>${data.fee_gen || 'N/A'}</div>
                </div>

                <div class="p-label">üë• Total Posts & Age Limit</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="p-table"><strong>Posts:</strong><br>${data.total_posts || 'N/A'}</div>
                    <div class="p-table"><strong>Age:</strong><br>${data.age_limit || 'N/A'}</div>
                </div>

                <div class="p-label">üìã Vacancy Details and Eligibility</div>
                <div class="p-table">${data.category_details || 'N/A'}</div>
                
                ${data.has_physical_standards ? `
                    <div class="p-label">üèÉ Physical Standards</div>
                    <div class="p-table">${data.physical_details || 'N/A'}</div>
                ` : ''}

                ${data.has_selection_mode ? `
                    <div class="p-label">üéØ Mode of Selection</div>
                    <div class="p-table">${data.selection_mode || 'N/A'}</div>
                ` : ''}

                <div class="p-label">üîó Important Links</div>
                <div class="p-table" style="background: rgba(236, 72, 153, 0.1); border: 1px dashed var(--accent);">
                    ${data.important_links || 'N/A'}
                </div>
            `;
            
            status.innerHTML = "‚úÖ Preview Updated!";
            status.style.color = "#22d3ee";
            
        } catch (e) {
            status.innerHTML = "‚ùå JSON Error: " + e.message;
            status.style.color = "#ef4444";
            console.error(e);
        }
    };

    uploadBtn.onclick = async function() {
        const rawJson = jsonInput.value.trim();
        if(!rawJson) return;

        status.innerHTML = "‚è≥ Uploading...";
        status.style.color = "#fbbf24";
        uploadBtn.disabled = true;

        try {
            const response = await fetch('/magic-tool/api/', { 
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}' 
                },
                body: rawJson
            });

            const result = await response.json();
            if(result.status === 'success') {
                status.innerHTML = "üöÄ SUCCESS: Website par live ho gaya!";
                status.style.color = "#4ade80";
                jsonInput.value = "";
                display.innerHTML = '<p class="empty-msg">Waiting for JSON data...</p>';
            } else {
                status.innerHTML = "‚ùå Error: " + result.message;
                status.style.color = "#ef4444";
            }
        } catch (err) {
            status.innerHTML = "‚ùå Connection Failed! Server check karein.";
            status.style.color = "#ef4444";
        } finally {
            uploadBtn.disabled = false;
        }
    };
</script>
{% endblock %}